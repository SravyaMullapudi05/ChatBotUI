<div class="chat-modal">

  <!-- Header -->
  <div class="chat-header">
    <div class="header-left">
      <div class="chat-icon-wrapper">
        <mat-icon class="chat-icon">smart_toy</mat-icon>
      </div>

      <div class="header-text">
        <div class="chat-title">Bhulekha Assistant</div>
        <div class="chat-status">
          <span class="status-dot"></span>
          <span>Online</span>
        </div>
      </div>
    </div>

    <div class="header-right">
      <button mat-icon-button class="header-btn" *ngFor="let btn of headerActions" [title]="btn.title"
        (click)="btn.click()">
        <mat-icon>{{ btn.icon }}</mat-icon>
      </button>
    </div>

    <!-- language menu -->
    <div class="language-menu" *ngIf="showLanguageMenu">
      <div class="lang-option" *ngFor="let lang of languages" (click)="selectLanguage(lang)">
        {{ lang.label }}
      </div>
    </div>

    <!-- settings menu -->
    <div class="settings-menu" *ngIf="showSettingsMenu">
      <div class="settings-title">Chat Settings</div>
      <div class="settings-option" *ngFor="let item of settingsOptions" (click)="item.action()">
        {{ item.label }}
      </div>
    </div>
  </div>

  <!-- Chat messages -->
  <div class="chat-messages" #scrollContainer>

    <!-- Normal messages -->
    <div *ngFor="let message of messages; trackBy: trackByMessageId" class="message-row"
      [ngClass]="{'bot-row': message.sender === 'bot', 'user-row': message.sender === 'user'}">

      <div *ngIf="message.sender === 'bot'" class="message-avatar">
        <mat-icon>smart_toy</mat-icon>
      </div>

      <div class="message-block">
        <div class="message-content" [ngClass]="{'bot-message': message.sender === 'bot',
                         'user-message': message.sender === 'user',
                         'button-like': message.sender === 'bot' && message.clickable}"
          (click)="onMessageClick(message)">
          {{ message.text }}
        </div>
        <div class="timestamp">{{ formatTimestamp(message.timestamp) }}</div>
      </div>

      <div *ngIf="message.sender === 'user'" class="message-user-avatar">
        <mat-icon>person</mat-icon>
      </div>
    </div>

    <!-- QUICK ACTIONS (WELCOME + MENU inside same bot bubble) -->
    <div *ngIf="showmainmenu" class="quick-actions-in-chat">

      <div class="bot-combined-bubble">
        <div class="bot-bubble-left">
          <mat-icon>smart_toy</mat-icon>
        </div>

        <div class="bot-bubble-content">
          <div class="bot-welcome-text">
            Hello! Welcome to Bhulekha Assistant. How can I help you today? </div>

          <div class="quick-action-buttons">
            <button class="quick-action-btn" *ngFor="let action of quickActions" (click)="handleAction(action)"
              [ngClass]="action.colorClass">

              <span class="btn-icon-wrap">
                <mat-icon class="btn-icon">{{ action.icon }}</mat-icon>
              </span>

              <span class="btn-label">{{ action.label }}</span>
            </button>
          </div>
        </div>
      </div>

    </div>

    <!-- Application Status Module -->
    <div *ngIf="subModules && subModules.length>0" class="status-module-box">

      <div class="bot-status-row">
        <div class="bot-status-avatar">
          <mat-icon>smart_toy</mat-icon>
        </div>

        <div class="bot-status-msg">
          Please select the module for which you want to check the application status:
        </div>
      </div>

      <div class="module-buttons">
        <button class="module-btn" *ngFor="let m of subModules" (click)="selectStatusModule(m)">
          {{ m }}
        </button>
      </div>

    </div>

    <!-- SERVICES MODULE -->
    <div *ngIf="showServices">
      <app-services-list (serviceSelected)="onServiceSelected($event)"></app-services-list>
    </div>

  </div>

  <!-- Input -->
  <div class="chat-input">
    <div class="input-container">

      <div class="input-wrapper">
        <textarea class="message-input" placeholder="Type your message here..." [(ngModel)]="newMessage" rows="1"
          (input)="autoResizeTextArea($event)" (keydown.enter)="onEnterPress($event)">
        </textarea>

        <button mat-icon-button class="emoji-btn" (click)="onEmojiClick()">
          <mat-icon>mood</mat-icon>
        </button>
      </div>

      <button mat-icon-button class="send-btn" (click)="sendMessage()">
        <mat-icon>send</mat-icon>
      </button>

    </div>

    <div class="help-text">Type /help for assistance</div>
  </div>

</div>