<div class="chat-modal">

  <!-- Header -->
  <app-header
    (translateClick)="onTranslateClick()"
    (settingsClick)="onSettingsClick()"
    (minimizeClick)="onMinimizeClick()"
    (closeClick)="closeChat()"
    (languageSelected)="selectLanguage($event)"
    (settingsSelected)="onHeaderSettingSelected($event)">
  </app-header>

  <!-- Chat messages -->
  <div class="chat-messages" #scrollContainer>

    <!-- Quick actions -->
    <div *ngIf="showmainmenu" class="quick-actions-in-chat">
      <div class="bot-combined-bubble w-80">
        <div class="bot-bubble-left me-2">
          <img src="../assets/images/logo.png" width="24" height="24" />
        </div>

        <div>
          <div class="bot-bubble-content mb-3 w-100">
            <div class="bot-welcome-text">
              Hello! Welcome to Bhulekha Assistant. How can I help you today?
            </div>
          </div>

          <div class="quick-action-buttons">
            <button
              class="quick-action-btn"
              *ngFor="let action of quickActions"
              (click)="handleAction(action)"
              [overlapTrigger]="false"
              [ngClass]="action.colorClass">

              <span class="btn-icon-wrap">
                <mat-icon class="btn-icon">{{ action.icon }}</mat-icon>
              </span>

              <span class="btn-label">{{ action.label }}</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Messages -->
    <ng-container *ngFor="let message of messages; trackBy: trackByMessageId">

      <div
        class="message-row"
        [ngClass]="{
          'bot-row': message.sender === 'bot',
          'user-row': message.sender === 'user'
        }">

        <!-- Bot avatar -->
        <div *ngIf="message.sender === 'bot'" class="message-avatar">
          <img src="../assets/images/logo.png" width="24" height="24" />
        </div>

        <div class="message-block" [ngClass]="{ 'w-80': message.sender === 'bot' }">

          <!-- Text message -->
          <div
            *ngIf="message.id !== 'typing'"
            class="message-content"
            [ngClass]="{
              'bot-message w-80 mb-2': message.sender === 'bot',
              'user-message': message.sender === 'user',
              'button-like': message.sender === 'bot' && message.clickable
            }"
            (click)="onMessageClick(message)">
            {{ message.text }}
          </div>

          <!-- Typing -->
          <div *ngIf="message.id === 'typing'" class="typing-dots">
            <span></span><span></span><span></span>
          </div>

          <!-- Modules -->
          <div class="module-buttons w-100" *ngIf="message.modules?.length">
            <button
              class="module-btn suggesstion d-flex justify-content-between"
              *ngFor="let m of message.modules"
              (click)="moduleAction(m)">
              {{ m.name }}
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>

          <!-- Questions -->
          <div *ngIf="message.questions?.length">
            <div
              class="module-buttons w-100 module-btn suggesstion mb-2"
              *ngFor="let q of message.questions">

              <div class="d-flex justify-content-between">
                <button class="noclass text-left"
                        (click)="showAnsforFaq(message.questions, q)">
                  <span>{{ q.question || q.title }}</span>

                  <mat-icon *ngIf="!q.icon">
                    {{ q.showanswer ? 'expand_less' : 'expand_more' }}
                  </mat-icon>

                  <mat-icon *ngIf="q.icon">arrow_downward</mat-icon>
                </button>
              </div>

              <div class="faq-answer" *ngIf="q.showanswer">
                {{ q.answer }}
              </div>
            </div>
          </div>

          <!-- Buttons -->
          <div class="feedback-buttons" *ngIf="message.buttons?.length">
            <button
              *ngFor="let btn of message.buttons"
              [class]="btn.class"
              (click)="btn.action()">
              {{ btn.label }}
            </button>
          </div>

          <!-- Status card -->
          <div class="service-box mb-2 mt-2" *ngIf="message.statusData as item">

            <div class="details">
              <span>Application number</span>
              <p>{{ item.applicationNumber }}</p>
            </div>

            <div class="d-flex justify-content-between">
              <div class="details">
                <span>Designation</span>
                <p>{{ item.designation }}</p>
              </div>

              <div class="details">
                <span>Date</span>
                <p class="d-grid">
                  {{ item.lastUpdated }}
                  <span>{{ item.time }}</span>
                </p>
              </div>
            </div>

            <div class="details d-inline-grid">
              <span>Status</span>
              <span [ngClass]="item.class">{{ item.status }}</span>
            </div>
          </div>

          <div class="timestamp">
            {{ formatTimestamp(message.timestamp) }}
          </div>
        </div>

        <!-- User avatar -->
        <div *ngIf="message.sender === 'user'" class="message-user-avatar">
          <mat-icon>person</mat-icon>
        </div>
      </div>

    </ng-container>

  </div>

  <!-- Footer -->
  <app-chat-footer
    (sendMessageEvent)="sendMessage($event)"
    (emojiClickEvent)="onEmojiClick()">
  </app-chat-footer>

</div>
